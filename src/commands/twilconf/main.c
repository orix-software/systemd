#include <stdio.h>
#include <conio.h>
#include <tgi.h>
#include <peekpoke.h>

#define COMMAND_ICON_POS_X 1
#define COMMAND_SYST_POS_X 7
#define COMMAND_JOY_POS_X 13

#define COMMAND_ICON_POS_Y 19




extern void start_twilfirmware();

char loaderBanner[]={
0x7c,0x40,0x40,0x5f,0x7f,0x78,0x5f,0x7f,0x78,0x7f,0x7f,0x70,0x5f,0x7f,0x7c,0x5f,0x7f,0x78,
0x7c,0x40,0x40,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x78,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,
0x7c,0x40,0x40,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,
0x7c,0x40,0x40,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,
0x7c,0x40,0x40,0x7c,0x40,0x7c,0x7c,0x40,0x7c,0x7c,0x41,0x7c,0x7c,0x40,0x40,0x7c,0x40,0x7c,
0x7c,0x40,0x40,0x7c,0x40,0x7c,0x7c,0x40,0x7c,0x7c,0x40,0x7c,0x7c,0x40,0x40,0x7c,0x40,0x7c,
0x7c,0x40,0x40,0x7c,0x40,0x7c,0x7f,0x7f,0x7c,0x7c,0x40,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,
0x7c,0x40,0x40,0x7c,0x40,0x7c,0x7f,0x7f,0x7c,0x7c,0x40,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,
0x7c,0x40,0x40,0x7c,0x40,0x7c,0x7f,0x7f,0x7c,0x7c,0x40,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,
0x7c,0x40,0x40,0x7c,0x40,0x7c,0x7f,0x7f,0x7c,0x7c,0x40,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x78,
0x7c,0x40,0x40,0x7c,0x40,0x7c,0x7c,0x40,0x7c,0x7c,0x40,0x7c,0x7c,0x40,0x40,0x7c,0x43,0x70,
0x7c,0x40,0x40,0x7c,0x40,0x7c,0x7c,0x40,0x7c,0x7c,0x41,0x7c,0x7c,0x40,0x40,0x7c,0x43,0x70,
0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7c,0x40,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7c,0x41,0x78,
0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7c,0x40,0x7c,0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7c,0x41,0x78,
0x7f,0x7f,0x7c,0x7f,0x7f,0x7c,0x7c,0x40,0x7c,0x7f,0x7f,0x78,0x7f,0x7f,0x7c,0x7c,0x40,0x7c,
0x7f,0x7f,0x7c,0x5f,0x7f,0x78,0x7c,0x40,0x7c,0x7f,0x7f,0x70,0x5f,0x7f,0x7c,0x7c,0x40,0x7c
};

char chipIcon[]={
0x40,0x40,0x40,0x40,0x40,
0x40,0x40,0x40,0x58,0x40,
0x40,0x40,0x41,0x66,0x40,
0x40,0x40,0x46,0x41,0x60,
0x40,0x40,0x58,0x40,0x58,
0x40,0x41,0x60,0x41,0x68,
0x40,0x46,0x40,0x46,0x48,
0x40,0x58,0x40,0x58,0x68,
0x41,0x60,0x41,0x60,0x78,
0x46,0x40,0x46,0x49,0x70,
0x47,0x40,0x58,0x4e,0x58,
0x47,0x71,0x62,0x5c,0x48,
0x47,0x7e,0x43,0x66,0x48,
0x47,0x7c,0x67,0x42,0x40,
0x41,0x7c,0x79,0x62,0x40,
0x40,0x5d,0x70,0x60,0x40,
0x40,0x46,0x58,0x60,0x40,
0x40,0x40,0x48,0x40,0x40,
0x40,0x40,0x48,0x40,0x40,
0x40,0x40,0x40,0x40,0x40,
0x40,0x40,0x40,0x40,0x40,
0x40,0x40,0x40,0x40,0x40
};

char demoIcon[]={
0x7f,0x7f,0x7f,0x7f,0x40,
0x67,0x7f,0x7f,0x7f,0x40,
0x7f,0x7f,0x7f,0x7f,0x40,
0x60,0x40,0x40,0x41,0x40,
0x6e,0x4e,0x62,0x59,0x40,
0x69,0x48,0x76,0x65,0x40,
0x68,0x68,0x6a,0x65,0x40,
0x68,0x6e,0x62,0x65,0x40,
0x68,0x68,0x62,0x65,0x40,
0x69,0x48,0x62,0x65,0x40,
0x6e,0x4e,0x62,0x59,0x40,
0x60,0x40,0x40,0x41,0x40,
0x60,0x40,0x40,0x41,0x40,
0x60,0x58,0x40,0x41,0x40,
0x60,0x5e,0x40,0x41,0x40,
0x60,0x5f,0x60,0x41,0x40,
0x60,0x5f,0x78,0x41,0x40,
0x60,0x5f,0x7e,0x41,0x40,
0x60,0x5f,0x78,0x41,0x40,
0x60,0x5f,0x60,0x41,0x40,
0x60,0x5e,0x40,0x41,0x40,
0x60,0x58,0x40,0x41,0x40,
0x60,0x40,0x40,0x41,0x40,
0x7f,0x7f,0x7f,0x7f,0x40
};

char tools_icon[]={
0x40,0x5c,0x40,0x41,0x60,
0x40,0x4f,0x40,0x47,0x70,
0x40,0x47,0x60,0x4f,0x70,
0x42,0x43,0x60,0x4f,0x60,
0x43,0x47,0x60,0x4f,0x60,
0x43,0x6f,0x60,0x5f,0x40,
0x41,0x7f,0x60,0x78,0x40,
0x41,0x7f,0x71,0x70,0x40,
0x40,0x7f,0x7b,0x60,0x40,
0x40,0x41,0x77,0x40,0x40,
0x40,0x40,0x6e,0x40,0x40,
0x40,0x40,0x5d,0x40,0x40,
0x40,0x40,0x7b,0x60,0x40,
0x40,0x47,0x77,0x70,0x40,
0x40,0x4f,0x63,0x78,0x40,
0x40,0x5f,0x61,0x7c,0x40,
0x40,0x7f,0x60,0x7e,0x40,
0x41,0x7f,0x40,0x5f,0x40,
0x43,0x7e,0x40,0x4f,0x60,
0x43,0x7c,0x40,0x47,0x60,
0x43,0x78,0x40,0x43,0x40,
0x41,0x70,0x40,0x40,0x40,
0x40,0x40,0x40,0x40,0x40
};








void changemenu(unsigned char current_menu) {
    unsigned char j;
    unsigned char item_pos;
    if (current_menu==0) {
        item_pos=COMMAND_ICON_POS_X-1;
        /*
        cputsxy(1,8,"Basic11");
        cputsxy(1,9,"Forth");
        cputsxy(1,10,"Basic11 software menu");
        */
    }

    if (current_menu==1) {
        item_pos=COMMAND_SYST_POS_X-1;
        /*
        cputsxy(1,8,"Pulsoids");
        cputsxy(1,9,"ZIP N ZAP");
        */

    }

    if (current_menu==2) {
        item_pos=COMMAND_JOY_POS_X-1;
        /*
        cputsxy(1,8,"Firmware version : 2");
        cputsxy(1,9,"CPU : 6502");
        cputsxy(1,10,"Microdisc register : yes");
        cputsxy(1,11,"Default storage : Usb");
        */
    }    

    for (j=0;j<26;j++) {
        POKE (0xa000+item_pos+j*40+COMMAND_ICON_POS_Y*40,0x6);
        POKE (0xa006+item_pos+j*40+COMMAND_ICON_POS_Y*40,0x7);
    }   
}

void clear_text_menu() {
    unsigned int j;
    /*
    for (j=0;j<400;j++) 
        POKE(0xbb80+8*40+j,' ');
        */

}

void switchoff_icon(unsigned char current_menu) {
    unsigned char j;
    unsigned char item_pos;
    clear_text_menu();
    if (current_menu==0) {
        item_pos=COMMAND_ICON_POS_X-1;
        
    }

    if (current_menu==1) {
        item_pos=COMMAND_SYST_POS_X-1;

    }

    if (current_menu==2) {
        item_pos=COMMAND_JOY_POS_X-1;
  
    }    

    for (j=0;j<26;j++) {
        POKE (0xa000+item_pos+j*40+COMMAND_ICON_POS_Y*40,0x7);
        POKE (0xa006+item_pos+j*40+COMMAND_ICON_POS_Y*40,0x6);
    }   


}


main() {
    unsigned char key;
    unsigned char j;
    unsigned int lj;
    unsigned char current_menu=0;
    start_twilfirmware();
    /*
    for (lj=100;lj<200;lj++)
        POKE(0xa000+lj*40,26);
        //POKE(0xbb80+(80/8)*40,0x1A);
*/
    changemenu(current_menu);


    while (1) {
        key=cgetc();
        if (key==27) break;
        if (key==9 && current_menu<2) {
            switchoff_icon(current_menu);
            current_menu++;
            changemenu(current_menu);
        }
        if (key==8 && current_menu>=1) {
            //switchoff_icon(current_menu);
            clear_text_menu();
            current_menu--;
            changemenu(current_menu);
        }
        if (key==27) break;
        
    }

}